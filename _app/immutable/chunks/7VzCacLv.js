import{o,q as m,u as d,v,d as l,w as p,h as u,l as _,x as b,y as g,e as k,z as w,A as y,B as x,D as A,E,m as F}from"./6nIWiFVB.js";class M{anchor;#s=new Map;#t=new Map;#e=new Map;#a=!0;constructor(t,a=!0){this.anchor=t,this.#a=a}#r=()=>{var t=o;if(this.#s.has(t)){var a=this.#s.get(t),s=this.#t.get(a);if(s)m(s);else{var e=this.#e.get(a);e&&(this.#t.set(a,e.effect),this.#e.delete(a),e.fragment.lastChild.remove(),this.anchor.before(e.fragment),s=e.effect)}for(const[r,i]of this.#s){if(this.#s.delete(r),r===t)break;const f=this.#e.get(i);f&&(d(f.effect),this.#e.delete(i))}for(const[r,i]of this.#t){if(r===a)continue;const f=()=>{if(Array.from(this.#s.values()).includes(r)){var h=document.createDocumentFragment();b(i,h),h.append(l()),this.#e.set(r,{effect:i,fragment:h})}else d(i);this.#t.delete(r)};this.#a||!s?v(i,f,!1):f()}}};ensure(t,a){var s=o,e=g();if(a&&!this.#t.has(t)&&!this.#e.has(t))if(e){var r=document.createDocumentFragment(),i=l();r.append(i),this.#e.set(t,{effect:p(()=>a(i)),fragment:r})}else this.#t.set(t,p(()=>a(this.anchor)));if(this.#s.set(s,t),e){for(const[f,n]of this.#t)f===t?s.skipped_effects.delete(n):s.skipped_effects.add(n);for(const[f,n]of this.#e)f===t?s.skipped_effects.delete(n.effect):s.skipped_effects.add(n.effect);s.add_callback(this.#r)}else u&&(this.anchor=_),this.#r()}}function D(c,t,...a){var s=new M(c);k(()=>{const e=t()??null;s.ensure(e,e&&(r=>e(r,...a)))},E)}function R(c){return(t,...a)=>{var s=c(...a),e;if(u)e=_,w();else{var r=s.render().trim(),i=y(r);e=F(i),t.before(e)}const f=s.setup?.(e);x(e,e),typeof f=="function"&&A(f)}}export{M as B,R as c,D as s};
